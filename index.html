<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Solar System 3D</title>
  <style>
    html, body { height: 100%; }
    body { margin: 0; overflow: hidden; background:#000; }
    canvas { display:block; }
  </style>
</head>
<body>
  <!-- Three.js : garde ton chemin local si le fichier est à côté -->
  <script src="three.min.js"></script>

  <script>
  // --- Scene / Camera / Renderer
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 3000);
  camera.position.set(0, 120, 450);
  camera.lookAt(0,0,0);

  const renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setPixelRatio(devicePixelRatio);
  renderer.setSize(innerWidth, innerHeight);
  document.body.appendChild(renderer.domElement);

  const loader = new THREE.TextureLoader();

  // --- Soleil texturé
  const sun = new THREE.Mesh(
    new THREE.SphereGeometry(55, 64, 64),
    new THREE.MeshBasicMaterial({ map: loader.load('textures/sun.jpg') })
  );
  scene.add(sun);

  // --- Halo doux autour du Soleil
  (function addSunGlow(){
    const c = document.createElement('canvas');
    c.width = c.height = 512;
    const ctx = c.getContext('2d');

    // Gradient radial: centre lumineux -> bords transparents
    const g = ctx.createRadialGradient(256, 256, 40, 256, 256, 250);
    g.addColorStop(0.00, 'rgba(255, 230, 120, 1.0)');
    g.addColorStop(0.35, 'rgba(255, 210, 90, 0.7)');
    g.addColorStop(0.70, 'rgba(255, 190, 50, 0.25)');
    g.addColorStop(1.00, 'rgba(255, 170, 0, 0.0)');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,512,512);

    const tex = new THREE.CanvasTexture(c);
    const glowMat = new THREE.SpriteMaterial({
      map: tex,
      color: 0xffd25a,
      transparent: true,
      opacity: 0.55,
      blending: THREE.AdditiveBlending,
      depthWrite: false,
      depthTest: false
    });
    const glow = new THREE.Sprite(glowMat);
    glow.scale.set(420, 420, 1);
    glow.renderOrder = 999;
    sun.add(glow);
  })();

  // --- Planètes (vitesses lentes)
  const planets = [];
  const planetData = [
    { label:'OUTREACH', name:'Neptune', size:12, distance:140, speed:0.006, tex:'textures/neptune.jpg', ellipse:0.75 },
    { label:'PERSONAL', name:'Venus',   size:16, distance:190, speed:0.004, tex:'textures/venus.jpg',   ellipse:0.78 },
    { label:'RESEARCH', name:'Earth',   size:18, distance:240, speed:0.003, tex:'textures/earth.jpg',   ellipse:0.80 }
  ];

  // --- Étiquette auto-scalée (~0,5× la planète = rayon)
  function makeBubbleLabel(text, planetRadius){
    // Canvas HD (netteté)
    const W = 256, H = 96, r = 14, tailW = 22, tailH = 12;
    const cvs = document.createElement('canvas');
    cvs.width = W; cvs.height = H + tailH;
    const ctx = cvs.getContext('2d');

    // fond semi-transparent
    ctx.fillStyle = 'rgba(80,80,80,0.75)';
    ctx.beginPath();
    ctx.moveTo(r,0); ctx.lineTo(W-r,0); ctx.quadraticCurveTo(W,0,W,r);
    ctx.lineTo(W,H-r); ctx.quadraticCurveTo(W,H,W-r,H);
    ctx.lineTo(50+tailW,H); ctx.lineTo(50,H+tailH); ctx.lineTo(50-tailW,H);
    ctx.lineTo(r,H); ctx.quadraticCurveTo(0,H,0,H-r);
    ctx.lineTo(0,r); ctx.quadraticCurveTo(0,0,r,0);
    ctx.closePath(); ctx.fill();

    // texte
    ctx.font = 'bold 30px system-ui, Arial';
    ctx.fillStyle = '#fff';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(text, W/2, H/2);

    const tex = new THREE.CanvasTexture(cvs);
    const spr = new THREE.Sprite(new THREE.SpriteMaterial({ map: tex, transparent: true }));

    // largeur ≈ 0.5× planète => = rayon ; hauteur ≈ 0.35× rayon
    const widthWorld  = planetRadius * 1.0;
    const heightWorld = planetRadius * 0.35;
    spr.scale.set(widthWorld, heightWorld, 1);
    return spr;
  }

  // --- Lumières
  scene.add(new THREE.AmbientLight(0xffffff, 0.35));
  scene.add(new THREE.PointLight(0xffffff, 1.4));

  // --- Orbites dégradées + planètes + labels
  const ORBIT_SEGMENTS = 256;

  planetData.forEach(d=>{
    // planète
    const mesh = new THREE.Mesh(
      new THREE.SphereGeometry(d.size,32,32),
      new THREE.MeshStandardMaterial({ map: loader.load(d.tex) })
    );
    mesh.userData = { angle: Math.random()*Math.PI*2, speed:d.speed, distance:d.distance, ellipse:d.ellipse };
    scene.add(mesh);

    // étiquette proportionnée au rayon de la planète
    const label = makeBubbleLabel(d.label, d.size);
    scene.add(label);

    // orbite fixe en dégradé
    const pos = new Float32Array(ORBIT_SEGMENTS * 3);
    const col = new Float32Array(ORBIT_SEGMENTS * 3);
    for (let i=0; i<ORBIT_SEGMENTS; i++){
      const t = (i / ORBIT_SEGMENTS) * Math.PI * 2;
      const x = Math.cos(t) * d.distance;
      const z = Math.sin(t) * d.distance * d.ellipse;
      const y = 0;
      pos[i*3+0] = x; pos[i*3+1] = y; pos[i*3+2] = z;

      const g = 0.25 + 0.75 * (i / (ORBIT_SEGMENTS-1)); // 0.25..1.0
      col[i*3+0] = g; col[i*3+1] = g; col[i*3+2] = g;
    }
    const orbitGeo = new THREE.BufferGeometry();
    orbitGeo.setAttribute('position', new THREE.BufferAttribute(pos,3));
    orbitGeo.setAttribute('color',    new THREE.BufferAttribute(col,3));
    const orbitMat = new THREE.LineBasicMaterial({ vertexColors:true, transparent:true, opacity:0.85 });
    const orbit    = new THREE.LineLoop(orbitGeo, orbitMat);
    scene.add(orbit);

    planets.push({ mesh, label, data:d });
  });

  // --- Resize
  addEventListener('resize', ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  });

  // --- Animation
  function animate(){
    requestAnimationFrame(animate);

    planets.forEach(p=>{
      const u = p.mesh.userData;
      u.angle += u.speed;

      const x = Math.cos(u.angle)*u.distance;
      const z = Math.sin(u.angle)*u.distance*u.ellipse;
      const y = 0;

      p.mesh.position.set(x,y,z);

      // place la bulle un peu au-dessus : rayon + ~la moitié de la hauteur de la bulle
      const bubbleHalfH = p.data.size * 0.35 * 0.5;
      p.label.position.set(x, p.data.size + bubbleHalfH + 6, z);
    });

    renderer.render(scene, camera);
  }
  animate();
  </script>
</body>
</html>
